<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Figma Plugin UI</title>

</head>

<body>

  <!-- resize icon -->
  <div id="resizeHandle" class="resize-handle">
    <svg width="16" height="16">
      <use href="#resize-icon" />
    </svg>
  </div>

  <!-- Splash Screen -->
  <div class="splash-screen" id="splashScreen">
    <img src="" alt="Welcome" class="splash-image" onload="console.log('–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω–æ')">
    <div class="splash-content">
      <h1 class="splash-title"></h1>
      <button id="startCheck" class="button-main">Deep dive</button>
    </div>
  </div>

  <!-- Main Content -->
  <div class="main-content" id="mainContent">
    <!-- –î–æ–±–∞–≤–ª—è–µ–º SVG-—Å–ø—Ä–∞–π—Ç –≤ –Ω–∞—á–∞–ª–æ body -->
    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
      <symbol id="instance-icon" viewBox="0 0 16 16">
        <path fill-rule="evenodd" clip-rule="evenodd"
          d="M7.29289 2.29289C7.68342 1.90237 8.31658 1.90237 8.70711 2.29289L13.7071 7.29289C14.0976 7.68342 14.0976 8.31658 13.7071 8.70711L8.70711 13.7071C8.31658 14.0976 7.68342 14.0976 7.29289 13.7071L2.29289 8.70711C1.90237 8.31658 1.90237 7.68342 2.29289 7.29289L7.29289 2.29289ZM3.70711 8.70711L3 8L3.70711 7.29289L7.29289 3.70711L8 3L8.70711 3.70711L12.2929 7.29289L13 8L12.2929 8.70711L8.70711 12.2929L8 13L7.29289 12.2929L3.70711 8.70711Z" />
      </symbol>
      <symbol id="info-icon" viewBox="0 0 16 16">
        <path fill-rule="evenodd" clip-rule="evenodd"
          d="M13 8C13 10.7614 10.7614 13 8 13C5.23858 13 3 10.7614 3 8C3 5.23858 5.23858 3 8 3C10.7614 3 13 5.23858 13 8ZM14 8C14 11.3137 11.3137 14 8 14C4.68629 14 2 11.3137 2 8C2 4.68629 4.68629 2 8 2C11.3137 2 14 4.68629 14 8ZM7.48297 10.5355C7.48297 10.8195 7.71318 11.0497 7.99717 11.0497C8.28116 11.0497 8.51137 10.8195 8.51137 10.5355V7.20027C8.51137 6.91629 8.28116 6.68607 7.99717 6.68607C7.71318 6.68607 7.48297 6.91629 7.48297 7.20027V10.5355ZM7.57956 5.90482C7.69698 6.01277 7.83713 6.06675 8.00001 6.06675C8.16478 6.06675 8.30493 6.01277 8.42047 5.90482C8.53789 5.79497 8.5966 5.66334 8.5966 5.50993C8.5966 5.35463 8.53789 5.223 8.42047 5.11505C8.30493 5.0052 8.16478 4.95027 8.00001 4.95027C7.83713 4.95027 7.69698 5.0052 7.57956 5.11505C7.46213 5.223 7.40342 5.35463 7.40342 5.50993C7.40342 5.66334 7.46213 5.79497 7.57956 5.90482Z" />
      </symbol>
      <symbol id="frame-icon" viewBox="0 0 16 16">
        <path fill-rule="evenodd" clip-rule="evenodd"
          d="M5.5 3C5.77614 3 6 3.22386 6 3.5V5H10V3.5C10 3.22386 10.2239 3 10.5 3C10.7761 3 11 3.22386 11 3.5V5H12.5C12.7761 5 13 5.22386 13 5.5C13 5.77614 12.7761 6 12.5 6H11V10H12.5C12.7761 10 13 10.2239 13 10.5C13 10.7761 12.7761 11 12.5 11H11V12.5C11 12.7761 10.7761 13 10.5 13C10.2239 13 10 12.7761 10 12.5V11H6V12.5C6 12.7761 5.77614 13 5.5 13C5.22386 13 5 12.7761 5 12.5V11H3.5C3.22386 11 3 10.7761 3 10.5C3 10.2239 3.22386 10 3.5 10H5V6H3.5C3.22386 6 3 5.77614 3 5.5C3 5.22386 3.22386 5 3.5 5H5V3.5C5 3.22386 5.22386 3 5.5 3ZM10 10L10 6H6V10H10Z" />
      </symbol>
      <symbol id="text-icon" viewBox="0 0 16 16">
        <path fill-rule="evenodd" clip-rule="evenodd"
          d="M3 3.5C3 3.22386 3.22386 3 3.5 3H8H12.5C12.7761 3 13 3.22386 13 3.5V5C13 5.27614 12.7761 5.5 12.5 5.5C12.2239 5.5 12 5.27614 12 5V4H8.5V12H9.5C9.77614 12 10 12.2239 10 12.5C10 12.7761 9.77614 13 9.5 13H8H6.5C6.22386 13 6 12.7761 6 12.5C6 12.2239 6.22386 12 6.5 12H7.5V4H4V5C4 5.27614 3.77614 5.5 3.5 5.5C3.22386 5.5 3 5.27614 3 5V3.5Z" />
      </symbol>
      <symbol id="rectangle-icon" viewBox="0 0 16 16">
        <path fill-rule="evenodd" clip-rule="evenodd"
          d="M11.5 4H4.5C4.22386 4 4 4.22386 4 4.5V11.5C4 11.7761 4.22386 12 4.5 12H11.5C11.7761 12 12 11.7761 12 11.5V4.5C12 4.22386 11.7761 4 11.5 4ZM4.5 3C3.67157 3 3 3.67157 3 4.5V11.5C3 12.3284 3.67157 13 4.5 13H11.5C12.3284 13 13 12.3284 13 11.5V4.5C13 3.67157 12.3284 3 11.5 3H4.5Z" />
      </symbol>
      <symbol id="select-all-icon" viewBox="0 0 24 24">
        <path fill-rule="evenodd" clip-rule="evenodd"
          d="M12 18C15.3137 18 18 15.3137 18 12C18 8.68629 15.3137 6 12 6C8.68629 6 6 8.68629 6 12C6 15.3137 8.68629 18 12 18ZM12 19C15.866 19 19 15.866 19 12C19 8.134 15.866 5 12 5C8.134 5 5 8.134 5 12C5 15.866 8.134 19 12 19ZM12 15C13.6569 15 15 13.6569 15 12C15 10.3431 13.6569 9 12 9C10.3431 9 9 10.3431 9 12C9 13.6569 10.3431 15 12 15ZM12 16C14.2091 16 16 14.2091 16 12C16 9.79086 14.2091 8 12 8C9.79086 8 8 9.79086 8 12C8 14.2091 9.79086 16 12 16ZM13 12C13 12.5523 12.5523 13 12 13C11.4477 13 11 12.5523 11 12C11 11.4477 11.4477 11 12 11C12.5523 11 13 11.4477 13 12Z" />
      </symbol>
      <symbol id="resize-icon" viewBox="0 0 24 24">
        <path fill-rule="evenodd" clip-rule="evenodd"
          d="M11.5219 16H11.5H8.5C8.22386 16 8 15.7761 8 15.5C8 15.2239 8.22386 15 8.5 15H11.5C12.2083 15 12.7095 14.9996 13.1013 14.9676C13.4872 14.9361 13.7228 14.8764 13.908 14.782C14.2843 14.5903 14.5903 14.2843 14.782 13.908C14.8764 13.7228 14.9361 13.4872 14.9676 13.1013C14.9996 12.7095 15 12.2083 15 11.5V8.5C15 8.22386 15.22386 8 15.5 8C15.7761 8 16 8.22386 16 8.5V11.5V11.5219C16 12.2034 16 12.7454 15.9643 13.1827C15.9277 13.6305 15.8512 14.0123 15.673 14.362C15.3854 14.9265 14.9265 15.3854 14.362 15.673C15.0123 15.8512 15.6305 15.9277 15.1827 15.9643C12.7454 16 12.2034 16 11.5219 16Z" />
      </symbol>
    </svg>

    <!-- Loader -->
    <div class="loader-container">
      <div class="progress-info">
        <div class="progress-counts">–û–±—Ä–∞–±–æ—Ç–∞–Ω–æ: <span id="processedCount">0</span> –∏–∑ <span id="totalCount">0</span>
        </div>
        <div class="progress-bar">
          <div class="progress-bar-fill" id="progressBarFill"></div>
        </div>
        <div class="progress-phase" id="progressPhase"></div>
      </div>
    </div>

    <!-- –í–µ—Å—å –∫–æ–Ω—Ç–µ–Ω—Ç -->
    <div class="container">
      <!-- Header -->
      <div class="header">
        <!-- –ö–Ω–æ–ø–∫–∞ -->
        <div class="button-wrapper">
          <button id="checkAll" class="button-main">New search</button>
          <div class="switch-container">
            <label for="showHiddenToggle" class="switch" style="text-decoration: none; cursor: pointer;">
              <input type="checkbox" id="showHiddenToggle" class="checkbox" checked>
              <span class="slider round"></span>
            </label>hidden
          </div>
        </div>
        <!-- Tabs -->
        <div class="tabs">
          <div class="tab errors active" data-tab="errorsTab">Errors</div>
          <div class="tab" data-tab="instances">Instanses</div>
          <div class="tab" data-tab="total">Nodes</div>
          <!--<div class="tab colors" data-tab="colors">Colors</div>-->
          <!--<div class="tab" data-tab="icons">Icons</div>-->
        </div>
        <div id="subTabs" class="tabs small" style="display: flex;">
          <div class="tab_borderless active" data-tab="review">Review</div>
          <div class="tab_borderless" data-tab="colors">Colors</div>
          <div class="tab_borderless" data-tab="outdated">Outdated</div>
          <div class="tab_borderless" data-tab="lost">Lost</div>
          <div class="tab_borderless" data-tab="deprecated">Deprecated</div>
          <div class="tab_borderless" data-tab="detached">Detached</div>
        </div>
      </div>
      <!-- –ö–æ–Ω—Ç–µ–Ω—Ç -->
      <div class="tabs-content">
        <!-- –ü–æ–¥–≤–∫–ª–∞–¥–∫–∏ –¥–ª—è –∏–Ω—Å—Ç–∞–Ω—Å–æ–≤ -->


        <!-- –ì–ª–∞–≤–Ω–∞—è –≤–∫–ª–∞–¥–∫–∞ –∏–Ω—Å—Ç–∞–Ω—Å–æ–≤ -->
        <div id="errorsTab" class="tab-content active"></div>
        <!-- –í—Å–µ –∏–Ω—Å—Ç–∞–Ω—Å—ã -->
        <div id="instances" class="tab-content">
          <!-- Search Results -->
          <div id="searchResults" style="display: none;"></div>
          <div id="results">
            <a href="#" class="toggle-groups" data-action="expand">expand all</a>
            <ul id="resultsList"></ul>
          </div>
        </div>

        <!-- Review - —Å–≤–æ–¥–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
        <div id="review" class="tab-content">
          <div id="reviewResults">
            <div class="review-summary">
              <div class="summary-grid">
                <div class="summary-item" data-tab="colors">
                  <div class="summary-icon colors-icon">üé®</div>
                  <div class="summary-content">
                    <div class="summary-title">Old colors</div>
                    <div class="summary-count" id="colors-count">0</div>
                  </div>
                </div>
                <div class="summary-item" data-tab="outdated">
                  <div class="summary-icon outdated-icon">‚ö†Ô∏è</div>
                  <div class="summary-content">
                    <div class="summary-title">Outdated components</div>
                    <div class="summary-count" id="outdated-count">0</div>
                  </div>
                </div>
                <div class="summary-item" data-tab="lost">
                  <div class="summary-icon lost-icon">‚ùå</div>
                  <div class="summary-content">
                    <div class="summary-title">Lost instances</div>
                    <div class="summary-count" id="lost-count">0</div>
                  </div>
                </div>
                <div class="summary-item" data-tab="deprecated">
                  <div class="summary-icon deprecated-icon">üö´</div>
                  <div class="summary-content">
                    <div class="summary-title">Deprecated components</div>
                    <div class="summary-count" id="deprecated-count">0</div>
                  </div>
                </div>
                <div class="summary-item" data-tab="detached">
                  <div class="summary-icon detached-icon">üîó</div>
                  <div class="summary-content">
                    <div class="summary-title">Detached components</div>
                    <div class="summary-count" id="detached-count">0</div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- –£—Å—Ç–∞—Ä–µ–≤—à–∏–µ –∏–Ω—Å—Ç–∞–Ω—Å—ã -->
        <div id="outdated" class="tab-content">
          <div id="outdatedResults">
            <a href="#" class="toggle-groups" data-action="expand">expand all</a>
            <ul id="outdatedResultsList"></ul>
          </div>
        </div>

        <!-- –ü–æ—Ç–µ—Ä—è–Ω–Ω—ã–µ –∏–Ω—Å—Ç–∞–Ω—Å—ã -->
        <div id="lost" class="tab-content">
          <div id="lostResults">
            <a href="#" class="toggle-groups" data-action="expand">expand all</a>
            <ul id="lostResultsList"></ul>
          </div>
        </div>

        <!-- –£—Å—Ç–∞—Ä–µ–≤—à–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã -->
        <div id="deprecated" class="tab-content">
          <div id="deprecatedResults">
            <a href="#" class="toggle-groups" data-action="expand">expand all</a>
            <ul id="deprecatedResultsList"></ul>
          </div>
        </div>

        <!-- –û—Ç—Å–æ–µ–¥–∏–Ω–µ–Ω–Ω—ã–µ —Ñ—Ä–µ–π–º—ã -->
        <div id="detached" class="tab-content">
          <div id="detachedResults">
            <a href="#" class="toggle-groups" data-action="expand">expand all</a>
            <ul id="detachedResultsList"></ul>
          </div>
        </div>

        <!-- Changelog -->
        <div id="log" class="tab-content">
          <h3>ToDo</h3>
          <p class="todo">–ü—Ä–∏—á–µ—Å–∞—Ç—å UI
            <br>–ù–µ –≤—Å–µ –∏–∫–æ–Ω–∫–∏ –æ–ø—Ä–µ–¥–µ–ª—è—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
            <br>–ó–∞–º–µ–Ω–∏—Ç—å hidden –Ω–∞ –∏–∫–æ–Ω–∫—É –∏ –¥–æ–±–∞–≤–∏—Ç—å –∫ –≥—Ä—É–ø–ø–∞–º –∏–∑ 1 —ç–ª–µ–º–µ–Ω—Ç–∞
            <br>–í –∏–Ω—Å—Ç–∞–Ω—Å–∞—Ö –ø–µ—Ä–µ–ø–∏—Å–∞—Ç—å –≤—ã–≤–æ–¥ –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ –≥—Ä—É–ø–ø–∞–º
            <br> –ü—Ä–æ–≤–µ—Ä—è—Ç—å fillStyleId –¥–ª—è —Ü–≤–µ—Ç–æ–≤
            <br> –ü–æ–ø—Ä–∞–≤–∏—Ç—å —Ç–µ–≥ –≥—Ä—É–ø–ø—ã –µ—Å–ª–∏ –≤–Ω—É—Ç—Ä–∏ —Ä–∞–∑–Ω—ã–µ –≤–µ—Ä—Å–∏–∏
            <br> –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –≤ —Ü–≤–µ—Ç–∞—Ö –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∞—Ç—å –ø–æ —Ç–∏–ø—É —ç–ª–µ–º–µ–Ω—Ç–∞
          </p>
        </div>
        <!-- –ò–∫–æ–Ω–∫–∏ -->
        <div id="icons" class="tab-content">
          <div id="iconResults">
            <a href="#" class="toggle-groups" data-action="expand">expand all</a>
            <ul id="iconResultsList"></ul>
          </div>
        </div>
        <!-- –¶–≤–µ—Ç–∞ -->
        <div id="colors" class="tab-content">
          <div id="colorResults">
            <a href="#" class="toggle-groups" data-action="expand">expand all</a>
            <ul id="colorResultsList"></ul>
            <ul id="colorStrokeResultsList"></ul>
          </div>
        </div>
        <!-- Total Statistics -->
        <div id="total" class="tab-content">
          <div class="stats-section">
            <ul id="overallStatsList" class="stats-list"></ul>
          </div>
        </div>
        <!-- Plugin Data -->
        <div id="component-data" class="tab-content">
          <h3>PluginData</h3>
          <p>–≠—Ç–æ —Ç—Ä–æ–≥–∞—Ç—å –Ω–µ –Ω–∞–¥–æ!</p>
          <div style="margin-bottom: 15px;">
            <label for="componentKey">–ö–ª—é—á –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞:</label>
            <input type="text" id="componentKey" placeholder="–í–≤–µ–¥–∏—Ç–µ –∫–ª—é—á"
              style="width: 100%; padding: 8px; margin-top: 5px; border: 1px solid #ccc; border-radius: 4px;">
          </div>

          <div style="margin-bottom: 15px;">
            <label for="componentVersion">–í–µ—Ä—Å–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞:</label>
            <input type="text" id="componentVersion" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä, 1.0.0"
              style="width: 100%; padding: 8px; margin-top: 5px; border: 1px solid #ccc; border-radius: 4px;">
          </div>

          <div class="small-button-wrapper">
            <button id="readComponentData" class="button-secondary">–ü—Ä–æ—á–∏—Ç–∞—Ç—å –¥–∞–Ω–Ω—ã–µ</button>
            <button id="setComponentData" class="button-secondary">–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ</button>
            <button id="clearComponentData" class="button-secondary">–û—á–∏—Å—Ç–∏—Ç—å –¥–∞–Ω–Ω—ã–µ</button>
          </div>

          <div id="componentDataOutput"
            style="margin-top: 20px; min-height: 100px; border: 1px solid #eee; border-radius: 4px; padding: 10px; background-color: #f9f9f9;">
            <p class="placeholder-text" style="color: #888; font-style: italic;">–ó–¥–µ—Å—å –±—É–¥–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç
              –æ–ø–µ—Ä–∞—Ü–∏–π.</p>
          </div>
        </div>
        <!-- Debug -->
        <div id="debug" class="tab-content">
          <h3>RAW Data</h3>
          <div class="search-container">
            <input type="text" id="debugSearchInput" placeholder="–ü–æ–∏—Å–∫ –≤ –æ—Ç–ª–∞–¥–æ—á–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏...">
          </div>
          <div id="debugContent" class="debug-tree"></div>
        </div>
      </div>
      <!-- Footer -->
      <div class='footer'>
        <div class='wrapper'>
          <div class="user-info"></div>
          <div class="tabs">
            <div class="tab" id='metadata' data-tab="component-data">Metadata</div>
            <div class="tab" data-tab="debug">Debug</div>
            <div class="tab" data-tab="log">Backlog</div>
          </div>
        </div>
      </div>

      <script>


        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ —ç–ª–µ–º–µ–Ω—Ç–æ–≤
        const splashScreen = document.getElementById('splashScreen');
        const splashImage = document.querySelector('.splash-image');
        const loaderContainer = document.querySelector('.loader-container');
        const processedCount = document.getElementById('processedCount');
        const totalCount = document.getElementById('totalCount');
        const progressBarFill = document.querySelector('.progress-bar-fill');


        document.addEventListener('DOMContentLoaded', function () {

          // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤–∫–ª–∞–¥–æ–∫
          const tabs = document.querySelectorAll('.tab[data-tab]'); // –í—ã–±–∏—Ä–∞–µ–º —Ç–æ–ª—å–∫–æ –≤–∫–ª–∞–¥–∫–∏ —Å –∞—Ç—Ä–∏–±—É—Ç–æ–º data-tab
          const subTabs = document.getElementById('subTabs');

          tabs.forEach(tab => {
            tab.addEventListener('click', () => {
              const tabId = tab.getAttribute('data-tab');

              // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∞–∫—Ç–∏–≤–µ–Ω –ª–∏ –ø–æ–∏—Å–∫
              const searchInput = document.getElementById('searchInput');
              const isSearchActive = searchInput && searchInput.value.trim() !== '';

              // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π –∫–æ–Ω—Ç–µ–Ω—Ç
              document.querySelectorAll('.tab-content').forEach(content => {
                content.style.display = content.id === tabId ? 'block' : 'none';
              });

              // –ï—Å–ª–∏ –ø–æ–∏—Å–∫ –∞–∫—Ç–∏–≤–µ–Ω –∏ –≤—ã–±—Ä–∞–Ω–∞ –≤–∫–ª–∞–¥–∫–∞ instances, —Å–æ—Ö—Ä–∞–Ω—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø–æ–∏—Å–∫–∞
              if (isSearchActive && tabId === 'instances') {
                const searchResults = document.getElementById('searchResults');
                const resultsDiv = document.getElementById('results');
                if (searchResults && resultsDiv) {
                  searchResults.style.display = 'block';
                  resultsDiv.style.display = 'none';
                }
              }

              // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—É—é –≤–∫–ª–∞–¥–∫—É
              tabs.forEach(t => t.classList.remove('active'));
              tab.classList.add('active');

              // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º/—Å–∫—Ä—ã–≤–∞–µ–º –¥–æ—á–µ—Ä–Ω–∏–µ –≤–∫–ª–∞–¥–∫–∏ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –≤—ã–±—Ä–∞–Ω–Ω–æ–π –≤–∫–ª–∞–¥–∫–∏
              if (subTabs) {
                const instancesRelatedTabs = ['errorsTab'];
                if (instancesRelatedTabs.includes(tabId)) {
                  subTabs.style.display = 'flex';

                  // –ï—Å–ª–∏ –ø–µ—Ä–µ—Ö–æ–¥–∏–º –Ω–∞ errorsTab, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∞–∫—Ç–∏–≤–∏—Ä—É–µ–º –ø–æ–¥–≤–∫–ª–∞–¥–∫—É review
                  if (tabId === 'errorsTab') {
                    // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –≤—Å–µ—Ö –ø–æ–¥–≤–∫–ª–∞–¥–æ–∫
                    document.querySelectorAll('.tab_borderless').forEach(subTab => {
                      subTab.classList.remove('active');
                    });
                    // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –ø–æ–¥–≤–∫–ª–∞–¥–∫—É review
                    const reviewSubTab = document.querySelector('.tab_borderless[data-tab="review"]');
                    if (reviewSubTab) {
                      reviewSubTab.classList.add('active');
                    }
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–æ–Ω—Ç–µ–Ω—Ç –≤–∫–ª–∞–¥–∫–∏ review
                    document.querySelectorAll('.tab-content').forEach(content => {
                      content.style.display = content.id === 'review' ? 'block' : 'none';
                    });
                  }
                } else if (tabId === 'instances') {
                  subTabs.style.display = 'none';
                  // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –¥–æ—á–µ—Ä–Ω–∏—Ö –≤–∫–ª–∞–¥–æ–∫
                  document.querySelectorAll('.tab_borderless').forEach(subTab => {
                    subTab.classList.remove('active');
                  });
                } else {
                  subTabs.style.display = 'none';
                  // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –¥–æ—á–µ—Ä–Ω–∏—Ö –≤–∫–ª–∞–¥–æ–∫
                  document.querySelectorAll('.tab_borderless').forEach(subTab => {
                    subTab.classList.remove('active');
                  });
                }
              }
            });
          });

          // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –¥–æ—á–µ—Ä–Ω–∏—Ö –≤–∫–ª–∞–¥–æ–∫
          const subTabElements = document.querySelectorAll('.tab_borderless[data-tab]');
          subTabElements.forEach(subTab => {
            subTab.addEventListener('click', () => {
              const tabId = subTab.getAttribute('data-tab');

              // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∞–∫—Ç–∏–≤–µ–Ω –ª–∏ –ø–æ–∏—Å–∫
              const searchInput = document.getElementById('searchInput');
              const isSearchActive = searchInput && searchInput.value.trim() !== '';

              // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π –∫–æ–Ω—Ç–µ–Ω—Ç
              document.querySelectorAll('.tab-content').forEach(content => {
                content.style.display = content.id === tabId ? 'block' : 'none';
              });

              // –ï—Å–ª–∏ –ø–æ–∏—Å–∫ –∞–∫—Ç–∏–≤–µ–Ω –∏ –≤—ã–±—Ä–∞–Ω–∞ –ø–æ–¥–≤–∫–ª–∞–¥–∫–∞ instances, —Å–æ—Ö—Ä–∞–Ω—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø–æ–∏—Å–∫–∞
              if (isSearchActive && tabId === 'instances') {
                const searchResults = document.getElementById('searchResults');
                const resultsDiv = document.getElementById('results');
                if (searchResults && resultsDiv) {
                  searchResults.style.display = 'block';
                  resultsDiv.style.display = 'none';
                }
              }

              // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—É—é –¥–æ—á–µ—Ä–Ω—é—é –≤–∫–ª–∞–¥–∫—É
              subTabElements.forEach(t => t.classList.remove('active'));
              subTab.classList.add('active');

              // –£–±–∏—Ä–∞–µ–º –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å —Å –æ—Å–Ω–æ–≤–Ω—ã—Ö –≤–∫–ª–∞–¥–æ–∫, –∫—Ä–æ–º–µ errorsTab
              tabs.forEach(t => {
                if (t.getAttribute('data-tab') !== 'errorsTab') {
                  t.classList.remove('active');
                }
              });

              // –û–±–µ—Å–ø–µ—á–∏–≤–∞–µ–º, —á—Ç–æ –æ—Å–Ω–æ–≤–Ω–∞—è –≤–∫–ª–∞–¥–∫–∞ errorsTab –æ—Å—Ç–∞–µ—Ç—Å—è –∞–∫—Ç–∏–≤–Ω–æ–π
              const instancesTab = document.querySelector('.tab[data-tab="errorsTab"]');
              if (instancesTab) {
                instancesTab.classList.add('active');
              }
            });
          });

          // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –≤–∫–ª–∞–¥–∫—É review (—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã–º –≤–∫–ª–∞–¥–∫–∞–º –≤ HTML)
          document.querySelectorAll('.tab-content').forEach(content => {
            content.style.display = content.id === 'review' ? 'block' : 'none';
          });

          // –£–±–∏—Ä–∞–µ–º –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å —Å –≤–∫–ª–∞–¥–∫–∏ instances, —Ç–∞–∫ –∫–∞–∫ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –∞–∫—Ç–∏–≤–Ω–∞ errorsTab
          const instancesTab = document.querySelector('.tab[data-tab="instances"]');
          if (instancesTab) {
            instancesTab.classList.remove('active');
          }
          
          // –£–±–µ–∂–¥–∞–µ–º—Å—è, —á—Ç–æ errorsTab –∞–∫—Ç–∏–≤–Ω–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
          const errorsTab = document.querySelector('.tab[data-tab="errorsTab"]');
          if (errorsTab) {
            errorsTab.classList.add('active');
          }

        });




        // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–Ω–æ–ø–∫–∏ –Ω–∞ splash screen
        document.getElementById('startCheck').addEventListener('click', () => {
          //console.log('–ö–Ω–æ–ø–∫–∞ startCheck –Ω–∞–∂–∞—Ç–∞');
          const loaderContainer = document.querySelector('.loader-container');
          loaderContainer.style.display = 'flex';

          // –°–∫—Ä—ã–≤–∞–µ–º splash screen –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –æ—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç
          document.getElementById('splashScreen').style.display = 'none';
          document.getElementById('mainContent').style.display = 'block';

          // –ó–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É
          parent.postMessage({ pluginMessage: { type: 'check-all' } }, '*');
        });

        document.getElementById('checkAll').addEventListener('click', () => {
          const loaderContainer = document.querySelector('.loader-container');
          loaderContainer.style.display = 'flex';
          parent.postMessage({ pluginMessage: { type: 'check-all' } }, '*');
        });


        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–Ω–æ–ø–∫–∏ "–ü—Ä–æ—á–∏—Ç–∞—Ç—å –¥–∞–Ω–Ω—ã–µ"
        document.getElementById('readComponentData').addEventListener('click', function () {
          //console.log('–ó–∞–ø—Ä–æ—Å –Ω–∞ —á—Ç–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞');
          parent.postMessage({ pluginMessage: { type: 'get-component-data' } }, '*');
        });


        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–Ω–æ–ø–∫–∏ "–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ"
        document.getElementById('setComponentData').addEventListener('click', function () {
          const key = document.getElementById('componentKey').value.trim();
          const version = document.getElementById('componentVersion').value.trim();

          //console.log('–ó–∞–ø—Ä–æ—Å –Ω–∞ —É—Å—Ç–∞–Ω–æ–≤–∫—É –¥–∞–Ω–Ω—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞:', { key, version });

          if (!key || !version) {
            UIModules.displayResult('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –∫–ª—é—á –∏ –≤–µ—Ä—Å–∏—é –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞.', true);
            return;
          }

          parent.postMessage({ pluginMessage: { type: 'set-component-data', key, version } }, '*');
        });

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–Ω–æ–ø–∫–∏ "–û—á–∏—Å—Ç–∏—Ç—å –¥–∞–Ω–Ω—ã–µ"
        document.getElementById('clearComponentData').addEventListener('click', function () {
          //console.log('–ó–∞–ø—Ä–æ—Å –Ω–∞ –æ—á–∏—Å—Ç–∫—É –¥–∞–Ω–Ω—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞');
          parent.postMessage({ pluginMessage: { type: 'clear-component-data' } }, '*');
        });



        const tabs = document.querySelectorAll('.tab');

        const tabContents = document.querySelectorAll('.tab-content');
        tabs.forEach(tab => {
          tab.addEventListener('click', () => {
            // Deactivate all tabs and tab contents
            tabs.forEach(t => t.classList.remove('active'));
            tabContents.forEach(tc => tc.classList.remove('active'));
            // Activate the clicked tab and its corresponding content
            tab.classList.add('active');
            const target = document.getElementById(tab.dataset.tab);
            target.classList.add('active');
          });
        });





        // Add after the existing tab switching logic
        document.querySelectorAll('.toggle-groups').forEach(toggle => {
          toggle.addEventListener('click', (e) => {
            e.preventDefault();
            const container = e.target.closest('div');
            const groupItems = container.querySelectorAll('.group-items');
            const isExpanding = e.target.dataset.action === 'expand';

            // Toggle all groups
            groupItems.forEach(group => {
              group.classList.toggle('expanded', isExpanding);
            });

            // Update toggle text and action
            e.target.textContent = isExpanding ? 'collapse all' : 'expand all';
            e.target.dataset.action = isExpanding ? 'collapse' : 'expand';
          });
        });


        // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –Ω–æ–≤–æ–≥–æ toggle "Show hidden"
        const showHiddenToggle = document.getElementById('showHiddenToggle');
        if (showHiddenToggle) {
          showHiddenToggle.addEventListener('change', () => {
            // –ü–µ—Ä–µ—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º —Å–ø–∏—Å–æ–∫ –∏–Ω—Å—Ç–∞–Ω—Å–æ–≤ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è toggle
            if (window.lastDebugData) {
              if (window.lastDebugData.components) {
                const resultsList = document.getElementById('resultsList');
                const iconResultsList = document.getElementById('iconResultsList');
                let allInstances = [];
                UIModules.processAndDisplayComponents(window.lastDebugData.components, allInstances, resultsList, iconResultsList);
              }
              if (window.lastDebugData.components) {
                const outdatedResultsList = document.getElementById('outdatedResultsList');
                let allInstances = [];
                UIModules.processAndDisplayComponents(window.lastDebugData.components, allInstances, outdatedResultsList, null, 'outdated');
              }
              if (window.lastDebugData.components) {
                const lostResultsList = document.getElementById('lostResultsList');
                let allInstances = [];
                UIModules.processAndDisplayComponents(window.lastDebugData.components, allInstances, lostResultsList, null, 'lost');
              }
              // Re-process and display colors
              UIModules.processAndDisplayColors(window.lastDebugData.colors, window.lastDebugData.colorsStroke);
            }
          });
        }
        const searchInput = document.getElementById('searchInput');
        const clearSearch = document.getElementById('clearSearch');
        const searchResults = document.getElementById('searchResults');
        const debugContent = document.getElementById('debug').querySelector('#debugContent');
        let allInstances = []; // Store all instances for searching
        let originalDebugContent = null;

        const debugSearchInput = document.getElementById('debugSearchInput');
        const debugClearSearch = document.getElementById('debugClearSearch');

        // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –ø–æ–∏—Å–∫–∞ –≤ debug
        debugSearchInput.addEventListener('input', function () {
          const searchTerm = this.value.trim();
          //console.log('Debug search term:', searchTerm);

          // –ï—Å–ª–∏ —ç—Ç–æ –ø–µ—Ä–≤—ã–π –ø–æ–∏—Å–∫, —Å–æ—Ö—Ä–∞–Ω—è–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ
          if (!originalDebugContent) {
            originalDebugContent = debugContent.innerHTML;
          }

          // –ï—Å–ª–∏ –ø–æ–ª–µ –ø–æ–∏—Å–∫–∞ –ø—É—Å—Ç–æ–µ, –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ
          if (!searchTerm) {
            debugContent.innerHTML = originalDebugContent;
            return;
          }

          // –ü–µ—Ä–µ—Å–æ–∑–¥–∞–µ–º –¥–µ—Ä–µ–≤–æ —Å —É—á–µ—Ç–æ–º –ø–æ–∏—Å–∫–æ–≤–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞
          const debugData = {
            type: 'debug-search',
            components: window.lastDebugData?.components || {},
            colors: window.lastDebugData?.colors || {},
            componentTree: window.lastDebugData?.componentTree || null,
            totalStats: window.lastDebugData?.totalStats || {}
          };

          debugContent.innerHTML = '';
          const newTree = UIModules.createDebugTree(debugData, searchTerm);
          if (newTree) {
            debugContent.appendChild(newTree);
          }
        });

        // –û–±–Ω–æ–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ–æ–±—â–µ–Ω–∏–π –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –æ—Ç–ª–∞–¥–∫–∏
        // Define displayComponentData in the global scope first
        window.displayComponentData = function (data) {
          const outputElement = document.getElementById('componentDataOutput');
          if (!outputElement) {
            console.error('–≠–ª–µ–º–µ–Ω—Ç –≤—ã–≤–æ–¥–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω');
            return;
          }

          outputElement.innerHTML = '';

          if (!data || Object.keys(data).length === 0) {
            UIModules.displayResult('–î–∞–Ω–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã.', true);
            return;
          }

          const container = document.createElement('div');
          container.style.fontFamily = 'monospace';

          for (const nodeId in data) {
            const nodeData = data[nodeId];

            const nodeTitle = document.createElement('h4');
            nodeTitle.textContent = `–ö–æ–º–ø–æ–Ω–µ–Ω—Ç: ${nodeData.name || '–ë–µ–∑ –∏–º–µ–Ω–∏'}`;
            nodeTitle.style.marginBottom = '5px';
            container.appendChild(nodeTitle);

            const nodeInfo = document.createElement('div');
            nodeInfo.style.marginLeft = '10px';
            nodeInfo.style.marginBottom = '15px';

            const idLine = document.createElement('div');
            idLine.textContent = `ID: ${nodeId}`;
            nodeInfo.appendChild(idLine);

            const keyLine = document.createElement('div');
            keyLine.textContent = `–ö–ª—é—á: ${nodeData.key || '–ù–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω'}`;
            keyLine.style.color = nodeData.key ? '#2e7d32' : '#d32f2f';
            nodeInfo.appendChild(keyLine);

            const versionLine = document.createElement('div');
            versionLine.textContent = `–í–µ—Ä—Å–∏—è: ${nodeData.version || '–ù–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞'}`;
            versionLine.style.color = nodeData.version ? '#2e7d32' : '#d32f2f';
            nodeInfo.appendChild(versionLine);

            if (nodeData.originalKey) {
              const originalKeyLine = document.createElement('div');
              originalKeyLine.textContent = `–û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π –∫–ª—é—á: ${nodeData.originalKey}`;
              originalKeyLine.style.color = '#666';
              nodeInfo.appendChild(originalKeyLine);
            }

            container.appendChild(nodeInfo);
          }

          outputElement.appendChild(container);
        };

        // Then define the message handler
        window.onmessage = (event) => {
          const msg = event.data.pluginMessage;
          if (!msg) return;

          // Handle special cases first
          if (msg.type === 'user-info') {
            const userInfoElement = document.querySelector('.user-info');
            const metadataTab = document.getElementById('metadata');
            if (userInfoElement) {
              if (!["Konstantin Kuzin", "III", "YYY"].includes(msg.user.name)) metadataTab.style.display = 'none';
              userInfoElement.textContent = msg.user.name;
            }
            return;
          }

          // Handle splash-data message
          if (msg.type === 'splash-data') {
            const splashImageElement = document.querySelector('.splash-image');
            const splashTitleElement = document.querySelector('.splash-title');
            const startCheckButton = document.getElementById('startCheck');

            if (splashImageElement && msg.data.imageUrl) {
              splashImageElement.src = msg.data.imageUrl;
            }
            if (splashTitleElement && msg.data.titleText) {
              splashTitleElement.textContent = msg.data.titleText;
            }
            if (startCheckButton && msg.data.buttonText) {
              startCheckButton.textContent = msg.data.buttonText;
            }
            return;
          }

          if (msg.type === 'resize') {
            const width = msg.width;
            const height = msg.height;
            window.resizeTo(width, height);
            return;
          }

          if (msg.type === 'display-total') {
            UIModules.displayTabTotal(msg.data);
            return;
          }

          if (msg.type === 'success') {
            hideLoader();

            // –û—á–∏—â–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
            const resultsList = document.getElementById('colorResultsList');
            if (resultsList) {
              resultsList.innerHTML = '';

              if (msg.instances && msg.instances.length > 0) {
                UIModules.displayGroups(msg.instances, resultsList, 'colors');
              } else { resultsList.innerHTML = '<p>–¶–≤–µ—Ç–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</p>'; }
            }
            else {
              //console.error('–ù–µ –Ω–∞–π–¥–µ–Ω —ç–ª–µ–º–µ–Ω—Ç colorResultsList');
            }
          }
          if (msg.type === 'progress-update') {
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∑–∞–≥—Ä—É–∑–∫–∏, –µ—Å–ª–∏ –æ–Ω –µ—â–µ –Ω–µ –ø–æ–∫–∞–∑–∞–Ω
            loaderContainer.style.display = 'flex';

            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø—Ä–æ–≥—Ä–µ—Å—Å–µ
            processedCount.textContent = msg.processed;
            totalCount.textContent = msg.total;

            // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä
            const percentage = (msg.processed / msg.total) * 100;
            progressBarFill.style.width = `${percentage}%`;
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–º—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞
            if (msg.currentComponentName) {
              document.getElementById('progressPhase').textContent = `${msg.currentComponentName}`;
            } else if (msg.type === 'progress-update' && msg.phase === 'check-updates') {
              document.getElementById('progressPhase').textContent = '–ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π...';
            } else {
              document.getElementById('progressPhase').textContent = '';
            }
          }
          if (msg.type === 'all-results') {

            // Save data for search
            window.lastDebugData = {
              components: msg.components,
              colors: msg.colors,
              colorsStroke: msg.colorsStroke,
              componentTree: msg.componentTree,
              totalStats: msg.totalStats
            };

            // Hide loader
            const loaderContainer = document.querySelector('.loader-container');
            if (loaderContainer) { loaderContainer.style.display = 'none'; }

            // Process components
            if (msg.components) {
              const resultsList = document.getElementById('resultsList');
              const iconResultsList = document.getElementById('iconResultsList');
              let allInstances = [];
              UIModules.processAndDisplayComponents(msg.components, allInstances, resultsList, iconResultsList);

              // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω–∏–∂–Ω–∏–µ –≤–∫–ª–∞–¥–∫–∏ –ø–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø–æ–∏—Å–∫–∞
              const subTabs = document.getElementById('subTabs');
              if (subTabs) {
                subTabs.style.display = 'flex';
              }

              // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –≤–∫–ª–∞–¥–∫—É Instances
              const instancesTab = document.querySelector('.tab[data-tab="errorsTab"]');
              if (instancesTab) {
                // –£–±–∏—Ä–∞–µ–º –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å —Å–æ –≤—Å–µ—Ö –æ—Å–Ω–æ–≤–Ω—ã—Ö –≤–∫–ª–∞–¥–æ–∫
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –≤–∫–ª–∞–¥–∫—É Instances
                instancesTab.classList.add('active');
              }

              // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –ø–æ–¥–≤–∫–ª–∞–¥–∫—É "All" –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –µ—ë –∫–æ–Ω—Ç–µ–Ω—Ç
              const allSubTab = document.querySelector('.tab_borderless[data-tab="instances"]');
              if (allSubTab) {
                document.querySelectorAll('.tab_borderless').forEach(t => t.classList.remove('active'));
                allSubTab.classList.add('active');

                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –∫–æ–Ω—Ç–µ–Ω—Ç –ø–æ–¥–≤–∫–ª–∞–¥–∫–∏ "All" (instances)
                document.querySelectorAll('.tab-content').forEach(content => {
                  content.style.display = content.id === 'instances' ? 'block' : 'none';
                });
              }
            }

            // Process outdated components if present
            if (msg.components) {
              const outdatedResultsList = document.getElementById('outdatedResultsList');
              let allInstances = [];
              UIModules.processAndDisplayComponents(msg.components, allInstances, outdatedResultsList, null, 'outdated');
            }

            // Process lost components if present
            if (msg.components) {
              const lostResultsList = document.getElementById('lostResultsList');
              let allInstances = [];
              UIModules.processAndDisplayComponents(msg.components, allInstances, lostResultsList, null, 'lost');
            }

            // Process deprecated components if present
            if (msg.components) {
              const deprecatedResultsList = document.getElementById('deprecatedResultsList');
              let allInstances = [];
              UIModules.processAndDisplayComponents(msg.components, allInstances, deprecatedResultsList, null, 'deprecated');
            }

            // Process detached components if present
            if (msg.components) {
              const detachedResultsList = document.getElementById('detachedResultsList');
              let allInstances = [];
              UIModules.processAndDisplayComponents(msg.components, allInstances, detachedResultsList, null, 'detached');
            }

            // Process colors
            if (msg.colors) {
              UIModules.processAndDisplayColors(msg.colors, msg.colorsStroke);
            }

            // Update review summary counts (–ø–æ—Å–ª–µ –≤—Å–µ—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –≤–∫–ª–∞–¥–æ–∫)
            updateReviewCounts(msg.components, msg.colors, msg.colorsStroke);

            // Update debug information
            debugContent.innerHTML = '';
            debugContent.className = 'debug-tree';

            // Create formatted debug output
            const debugData = {
              type: msg.type,
              timestamp: new Date().toISOString(),
              components: msg.components,
              colors: msg.colors,
              colorsStroke: msg.colorsStroke,
              componentTree: msg.componentTree,
              totalStats: msg.totalStats
            };

            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–µ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –ø—Ä–∏ –Ω–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
            originalDebugContent = null;

            // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –¥–∞–Ω–Ω—ã–µ –≤ –¥—Ä–µ–≤–æ–≤–∏–¥–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É
            const tree = UIModules.createDebugTree(debugData);
            if (tree) {
              debugContent.appendChild(tree);
              //console.log('–û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞');
            } else {
              //console.error('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ–∑–¥–∞—Ç—å –¥–µ—Ä–µ–≤–æ –æ—Ç–ª–∞–¥–∫–∏');
            }
          }
          if (msg.type === 'connection-waiting') {
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –ø—Ä–æ–±–ª–µ–º–∞—Ö —Å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ–º
            loaderContainer.style.display = 'flex';
            document.getElementById('progressPhase').textContent = 'Waiting for connection...';
            processedCount.textContent = '0';
            totalCount.textContent = '0';
            progressBarFill.style.width = '0%';
            return;
          }

          if (msg.type === 'retry-notification') {
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –ø–æ–ø—ã—Ç–∫–µ, –Ω–æ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —Å—á–µ—Ç—á–∏–∫ –µ—â–µ –Ω–µ –∑–∞–ø—É—â–µ–Ω
            const currentPhase = document.getElementById('progressPhase').textContent;
            if (!currentPhase.includes('–∏–∑')) {
              document.getElementById('progressPhase').textContent = msg.message;
            }
            return;
          }

          if (msg.type === 'error') {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —ç—Ç–æ –æ—à–∏–±–∫–æ–π —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
            const isConnectionError = msg.message && (
              msg.message.includes('–°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å Figma –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ') ||
              msg.message.includes('–ù–µ —É–¥–∞–ª–æ—Å—å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ')
            );

            if (!isConnectionError) {
              loaderContainer.style.display = 'none';
            }

            // –£–¥–∞–ª—è–µ–º –ø—Ä–µ–¥—ã–¥—É—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ, –µ—Å–ª–∏ –æ–Ω–æ –µ—Å—Ç—å
            const existingError = document.querySelector('.error-message');
            if (existingError) {
              existingError.remove();
            }

            // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ
            const errorDiv = document.createElement('div');
            errorDiv.className = 'error-message';
            const errorText = document.createElement('p');
            errorText.textContent = msg.message;
            errorDiv.appendChild(errorText);
            document.body.appendChild(errorDiv);

            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∫—Ä—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
            setTimeout(() => { errorDiv.remove(); }, 5000);

            // –î–æ–±–∞–≤–ª—è–µ–º –æ—à–∏–±–∫—É –≤ –æ—Ç–ª–∞–¥–æ—á–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
            const debugError = document.createElement('div');
            debugError.style.color = 'red';
            debugError.textContent = `Error: ${msg.message}`;
            debugContent.appendChild(debugError);
          }

          if (msg.type === 'component-data-result') {
            if (msg.data) {
              displayComponentData(msg.data);
            } else if (msg.message) {
              UIModules.displayResult(msg.message, msg.isError);
            } else {
              UIModules.displayResult('–î–∞–Ω–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã.');
            }
            return;
          }

          if (msg.type === 'component-data-set') {
            UIModules.displayResult(msg.message || '–î–∞–Ω–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ —É—Å–ø–µ—à–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã.', msg.isError);
            return;
          }

          if (msg.type === 'component-data-cleared') {
            UIModules.displayResult(msg.message || '–î–∞–Ω–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ —É—Å–ø–µ—à–Ω–æ –æ—á–∏—â–µ–Ω—ã.', msg.isError);
            return;
          }


          // –í—ã–ø–æ–ª–Ω—è–µ–º –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
          window.addEventListener('DOMContentLoaded', function () {

            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –≥–ª–æ–±–∞–ª—å–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é displayComponentData
            window.displayComponentData = function (data) {
              const outputElement = document.getElementById('componentDataOutput');
              if (!outputElement) {
                console.error('–≠–ª–µ–º–µ–Ω—Ç –≤—ã–≤–æ–¥–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω');
                return;
              }

              outputElement.innerHTML = '';

              if (!data || Object.keys(data).length === 0) {
                UIModules.displayResult('–î–∞–Ω–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã.', true);
                return;
              }

              const container = document.createElement('div');
              container.style.fontFamily = 'monospace';

              for (const nodeId in data) {
                const nodeData = data[nodeId];

                const nodeTitle = document.createElement('h4');
                nodeTitle.textContent = `–ö–æ–º–ø–æ–Ω–µ–Ω—Ç: ${nodeData.name || '–ë–µ–∑ –∏–º–µ–Ω–∏'}`;
                nodeTitle.style.marginBottom = '5px';
                container.appendChild(nodeTitle);

                const nodeInfo = document.createElement('div');
                nodeInfo.style.marginLeft = '10px';
                nodeInfo.style.marginBottom = '15px';

                const idLine = document.createElement('div');
                idLine.textContent = `ID: ${nodeId}`;
                nodeInfo.appendChild(idLine);

                const keyLine = document.createElement('div');
                keyLine.textContent = `–ö–ª—é—á: ${nodeData.key || '–ù–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω'}`;
                keyLine.style.color = nodeData.key ? '#2e7d32' : '#d32f2f';
                nodeInfo.appendChild(keyLine);

                const versionLine = document.createElement('div');
                versionLine.textContent = `–í–µ—Ä—Å–∏—è: ${nodeData.version || '–ù–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞'}`;
                versionLine.style.color = nodeData.version ? '#2e7d32' : '#d32f2f';
                nodeInfo.appendChild(versionLine);

                // –î–æ–±–∞–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ PluginData
                if (nodeData.pluginDataKey || nodeData.pluginDataVersion) {
                  // –î–æ–±–∞–≤–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ –¥–ª—è –¥–∞–Ω–Ω—ã—Ö –∏–∑ PluginData
                  const pluginDataHeader = document.createElement('div');
                  pluginDataHeader.textContent = '–î–∞–Ω–Ω—ã–µ –∏–∑ PluginData:';
                  pluginDataHeader.style.fontWeight = 'bold';
                  pluginDataHeader.style.marginTop = '8px';
                  pluginDataHeader.style.marginBottom = '4px';
                  nodeInfo.appendChild(pluginDataHeader);

                  // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –∫–ª—é—á –∏–∑ PluginData
                  const pluginDataKeyLine = document.createElement('div');
                  pluginDataKeyLine.textContent = `–ö–ª—é—á –∏–∑ PluginData: ${nodeData.pluginDataKey || '–ù–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω'}`;
                  pluginDataKeyLine.style.color = nodeData.pluginDataKey ? '#2e7d32' : '#d32f2f';
                  pluginDataKeyLine.style.marginLeft = '10px';
                  nodeInfo.appendChild(pluginDataKeyLine);

                  // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –≤–µ—Ä—Å–∏—é –∏–∑ PluginData
                  const pluginDataVersionLine = document.createElement('div');
                  pluginDataVersionLine.textContent = `–í–µ—Ä—Å–∏—è –∏–∑ PluginData: ${nodeData.pluginDataVersion || '–ù–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞'}`;
                  pluginDataVersionLine.style.color = nodeData.pluginDataVersion ? '#2e7d32' : '#d32f2f';
                  pluginDataVersionLine.style.marginLeft = '10px';
                  nodeInfo.appendChild(pluginDataVersionLine);
                }

                container.appendChild(nodeInfo);
              }

              outputElement.appendChild(container);
            };

            // –ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ–æ–±—â–µ–Ω–∏–π
            const originalMessageHandler = window.onmessage;
            window.addEventListener('message', function (event) {
              if (!event.data.pluginMessage) return;

              const msg = event.data.pluginMessage;
              //console.log('–ü–æ–ª—É—á–µ–Ω–æ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç –ø–ª–∞–≥–∏–Ω–∞:', msg);

              // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –¥–ª—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
              switch (msg.type) {
                case 'component-data-result':
                  if (msg.data) {
                    const outputElement = document.getElementById('componentDataOutput');
                    if (!outputElement) {
                      console.error('–≠–ª–µ–º–µ–Ω—Ç –≤—ã–≤–æ–¥–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω');
                      return;
                    }

                    outputElement.innerHTML = '';

                    if (Object.keys(msg.data).length === 0) {
                      UIModules.displayResult('–î–∞–Ω–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã.', true);
                      return;
                    }

                    const container = document.createElement('div');
                    container.style.fontFamily = 'monospace';

                    for (const nodeId in msg.data) {
                      const nodeData = msg.data[nodeId];

                      const nodeTitle = document.createElement('h4');
                      nodeTitle.textContent = `–ö–æ–º–ø–æ–Ω–µ–Ω—Ç: ${nodeData.name || '–ë–µ–∑ –∏–º–µ–Ω–∏'}`;
                      nodeTitle.style.marginBottom = '5px';
                      container.appendChild(nodeTitle);

                      const nodeInfo = document.createElement('div');
                      nodeInfo.style.marginLeft = '10px';
                      nodeInfo.style.marginBottom = '15px';

                      const idLine = document.createElement('div');
                      idLine.textContent = `ID: ${nodeId}`;
                      nodeInfo.appendChild(idLine);

                      const keyLine = document.createElement('div');
                      keyLine.textContent = `–ö–ª—é—á: ${nodeData.key || '–ù–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω'}`;
                      keyLine.style.color = nodeData.key ? '#2e7d32' : '#d32f2f';
                      nodeInfo.appendChild(keyLine);

                      const versionLine = document.createElement('div');
                      versionLine.textContent = `–í–µ—Ä—Å–∏—è: ${nodeData.version || '–ù–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞'}`;
                      versionLine.style.color = nodeData.version ? '#2e7d32' : '#d32f2f';
                      nodeInfo.appendChild(versionLine);

                      if (nodeData.originalKey) {
                        const originalKeyLine = document.createElement('div');
                        originalKeyLine.textContent = `–û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π –∫–ª—é—á: ${nodeData.originalKey}`;
                        originalKeyLine.style.color = '#666';
                        nodeInfo.appendChild(originalKeyLine);
                      }

                      container.appendChild(nodeInfo);
                    }

                    outputElement.appendChild(container);
                  } else if (msg.message) {
                    UIModules.displayResult(msg.message, msg.isError);
                  } else {
                    UIModules.displayResult('–î–∞–Ω–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã.');
                  }
                  break;

                case 'component-data-set':
                  UIModules.displayResult(msg.message || '–î–∞–Ω–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ —É—Å–ø–µ—à–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã.', msg.isError);
                  break;

                case 'component-data-cleared':
                  UIModules.displayResult(msg.message || '–î–∞–Ω–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ —É—Å–ø–µ—à–Ω–æ –æ—á–∏—â–µ–Ω—ã.', msg.isError);
                  break;
              }
            });


          });

        };



        // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–µ—Å–∞–π–∑–∞ –æ–∫–Ω–∞
        const resizeHandle = document.getElementById('resizeHandle');
        let isResizing = false;
        let initialWidth;
        let initialHeight;
        let initialX;
        let initialY;

        resizeHandle.addEventListener('mousedown', (e) => {
          isResizing = true;
          initialWidth = window.innerWidth;
          initialHeight = window.innerHeight;
          initialX = e.clientX;
          initialY = e.clientY;
        });

        document.addEventListener('mousemove', (e) => {
          if (!isResizing) return;

          const newWidth = initialWidth + (e.clientX - initialX);
          const newHeight = initialHeight + (e.clientY - initialY);

          // Ensure minimum dimensions
          const width = Math.max(newWidth, 300);
          const height = Math.max(newHeight, 200);

          // Directly resize the window
          window.resizeTo(width, height);

          // Also notify the plugin
          parent.postMessage({
            pluginMessage: {
              type: 'resize',
              width: width,
              height: height
            }
          }, '*');

          // Prevent selection during resize
          e.preventDefault();
        });

        document.addEventListener('mouseup', () => { isResizing = false; });


        // Search functionality
        if (searchInput && clearSearch && searchResults) {
          searchInput.addEventListener('input', () => {
            const searchTerm = searchInput.value.toLowerCase();
            clearSearch.style.display = searchTerm ? 'block' : 'none';

            if (!searchTerm) {
              searchResults.innerHTML = '';
              searchResults.style.display = 'none';
              // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ–±—ã—á–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç instances
              const resultsDiv = document.getElementById('results');
              if (resultsDiv) {
                resultsDiv.style.display = 'block';
              }
              // –í–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –∫ –∞–∫—Ç–∏–≤–Ω–æ–π –≤–∫–ª–∞–¥–∫–µ
              const activeTab = document.querySelector('.tab.active');
              if (activeTab) {
                const tabId = activeTab.getAttribute('data-tab');
                document.querySelectorAll('.tab-content').forEach(content => {
                  content.style.display = content.id === tabId ? 'block' : 'none';
                });
              }
              return;
            }

            const results = allInstances.filter(instance => {
              const name = instance.name.toLowerCase();
              const description = (instance.description || '').toLowerCase();
              return name.includes(searchTerm) || description.includes(searchTerm);
            });

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞
            searchResults.style.display = 'block';

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –≤–∫–ª–∞–¥–∫—É instances
            document.querySelectorAll('.tab-content').forEach(content => {
              content.style.display = content.id === 'instances' ? 'block' : 'none';
            });

            // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º—Å—è –Ω–∞ –≤–∫–ª–∞–¥–∫—É Instances (–Ω–µ errorsTab!)
            tabs.forEach(t => t.classList.remove('active'));
            const instancesTab = document.querySelector('.tab[data-tab="instances"]');
            if (instancesTab) {
              instancesTab.classList.add('active');
            }

            // –°–∫—Ä—ã–≤–∞–µ–º –¥–æ—á–µ—Ä–Ω–∏–µ –≤–∫–ª–∞–¥–∫–∏ –ø—Ä–∏ –ø–æ–∏—Å–∫–µ –≤ instances
            const subTabs = document.getElementById('subTabs');
            if (subTabs) {
              subTabs.style.display = 'none';
              const subTabElements = subTabs.querySelectorAll('.tab_borderless');
              subTabElements.forEach(t => t.classList.remove('active'));
            }

            UIModules.displaySearchResults(results, searchTerm);
          });

          // Clear search
          clearSearch.addEventListener('click', () => {
            searchInput.value = '';
            searchResults.innerHTML = '';
            searchResults.style.display = 'none';
            clearSearch.style.display = 'none';

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ–±—ã—á–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç instances
            const resultsDiv = document.getElementById('results');
            if (resultsDiv) {
              resultsDiv.style.display = 'block';
            }

            // –í–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –∫ –∞–∫—Ç–∏–≤–Ω–æ–π –≤–∫–ª–∞–¥–∫–µ
            const activeTab = document.querySelector('.tab.active');
            if (activeTab) {
              const tabId = activeTab.getAttribute('data-tab');
              document.querySelectorAll('.tab-content').forEach(content => {
                content.style.display = content.id === tabId ? 'block' : 'none';
              });
            }
          });
        }

        // Functions moved to UIModules

        // Function to update review summary counts
        function updateReviewCounts(componentsData, colorsData, colorsStrokeData) {
          // –ò–∑–≤–ª–µ–∫–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–∑ —É–∂–µ –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö –≤–∫–ª–∞–¥–æ–∫
          const extractCount = (tabSelector) => {
            const tab = document.querySelector(tabSelector);
            if (!tab || !tab.textContent) return 0;
            const match = tab.textContent.match(/\((\d+)\)/);
            return match ? parseInt(match[1], 10) : 0;
          };

          // –ü–æ–ª—É—á–∞–µ–º –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –∏–∑ –≤–∫–ª–∞–¥–æ–∫
          const colorsCount = extractCount('[data-tab="colors"]');
          const outdatedCount = extractCount('[data-tab="outdated"]');
          const lostCount = extractCount('[data-tab="lost"]');
          const deprecatedCount = extractCount('[data-tab="deprecated"]');
          const detachedCount = extractCount('[data-tab="detached"]');

          // Update UI
          const colorsCountEl = document.getElementById('colors-count');
          const outdatedCountEl = document.getElementById('outdated-count');
          const lostCountEl = document.getElementById('lost-count');
          const deprecatedCountEl = document.getElementById('deprecated-count');
          const detachedCountEl = document.getElementById('detached-count');

          if (colorsCountEl) colorsCountEl.textContent = colorsCount;
          if (outdatedCountEl) outdatedCountEl.textContent = outdatedCount;
          if (lostCountEl) lostCountEl.textContent = lostCount;
          if (deprecatedCountEl) deprecatedCountEl.textContent = deprecatedCount;
          if (detachedCountEl) detachedCountEl.textContent = detachedCount;
        }

        // Add click handlers for summary items
        document.addEventListener('DOMContentLoaded', function() {
          const summaryItems = document.querySelectorAll('.summary-item');
          summaryItems.forEach(item => {
            item.addEventListener('click', function() {
              const targetTab = this.getAttribute('data-tab');
              if (targetTab) {
                // Switch to the corresponding sub-tab
                const subTabs = document.querySelectorAll('.tab_borderless');
                subTabs.forEach(tab => {
                  tab.classList.remove('active');
                  if (tab.getAttribute('data-tab') === targetTab) {
                    tab.classList.add('active');
                  }
                });

                // Show the corresponding tab content
                const tabContents = document.querySelectorAll('.tab-content');
                tabContents.forEach(content => {
                  content.style.display = content.id === targetTab ? 'block' : 'none';
                });
              }
            });
          });
        });

        // Removed duplicate check-updates handler and redundant inputs init (moved earlier)

      </script>
</body>

</html>