# Руководство по тестированию

## Как запустить тесты

### Установка зависимостей

Перед первым запуском тестов убедитесь, что установлены все необходимые зависимости:

```bash
npm install
```

### Команды для запуска тестов

#### Запуск всех тестов
```bash
npm test
```

#### Запуск тестов в режиме наблюдения (watch mode)
```bash
npm run test:watch
```

#### Запуск тестов с покрытием кода
```bash
npm run test:coverage
```

#### Запуск конкретных типов тестов

**Модульные тесты:**
```bash
npm run test:unit
```

**Интеграционные тесты:**
```bash
npm run test:integration
```

**UI тесты:**
```bash
npm run test:ui
```

### Структура тестов

- `test/unit/` - модульные тесты отдельных функций и компонентов
- `test/integration/` - интеграционные тесты взаимодействия между компонентами
- `test/ui/` - тесты пользовательского интерфейса
- `test/e2e/` - end-to-end тесты (требуют дополнительной настройки)
- `test/mocks/` - моки для внешних зависимостей
- `test/utils/` - вспомогательные утилиты для тестов

### Написание тестов

#### Пример модульного теста

```typescript
import { mockFn } from '../setup';

describe('Название модуля', () => {
  test('должен выполнять определенное действие', () => {
    // Arrange - подготовка данных
    const input = 'test';
    
    // Act - выполнение действия
    const result = someFunction(input);
    
    // Assert - проверка результата
    expect(result).toBe('expected');
  });
});
```

#### Работа с моками Figma API

В тестах доступны моки основных методов Figma API:

```typescript
test('должен использовать Figma API', () => {
  const figma = (globalThis as any).figma;
  
  // Вызов мока
  figma.notify('Тестовое сообщение');
  
  // Проверка, что мок был вызван
  expect(figma.notify).toBeDefined();
});
```

### Отладка тестов

#### Запуск одного теста
```bash
npm test -- --testNamePattern="название теста"
```

#### Запуск тестов из конкретного файла
```bash
npm test -- test/unit/example.test.ts
```

#### Подробный вывод
```bash
npm test -- --verbose
```

### Конфигурация

Конфигурация Jest находится в файле `test/jest.config.js`. Основные настройки:

- Использует `ts-jest` для обработки TypeScript
- Настроены алиасы путей для удобного импорта
- Подключен файл настройки с моками Figma API
- Настроено покрытие кода

### Рекомендации

1. **Именование тестов**: используйте описательные названия на русском языке
2. **Структура теста**: следуйте паттерну Arrange-Act-Assert
3. **Изоляция**: каждый тест должен быть независимым
4. **Моки**: используйте моки для внешних зависимостей
5. **Покрытие**: стремитесь к высокому покрытию кода тестами

### Устранение проблем

#### Ошибки TypeScript
Если возникают ошибки типизации, проверьте:
- Правильность импортов
- Наличие необходимых типов в `@types/jest`
- Конфигурацию TypeScript в `tsconfig.json`

#### Проблемы с модулями
Если модули не находятся:
- Проверьте настройки `moduleNameMapper` в `jest.config.js`
- Убедитесь, что пути к файлам корректны

#### Медленные тесты
Для ускорения тестов:
- Используйте `--maxWorkers=4` для параллельного выполнения
- Оптимизируйте тяжелые операции в тестах
- Используйте моки вместо реальных вызовов API